<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>顺庆区区委办督查督办管理系统</title>
    <!-- 引入样式 -->

    <link rel="stylesheet" href="http://unpkg.com/iview/dist/styles/iview.css">
    <link rel="stylesheet" href="../css/load.css">
    <!--
    <link rel="stylesheet" href="css/iview.css">
        -->
    <!-- import Vue before Element -->
    <!--
    <script src="http://vuejs.org/js/vue.min.js"></script>
     -->
    <script src="../js/vue.min.js"></script>
    <!-- 引入组件库 -->
    <!--
    <script src="http://unpkg.com/iview/dist/iview.min.js"></script>
    -->
    <script src="../js/iview.min.js"></script>
    <script type="text/javascript" src="../lib/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="../lib/layer/2.4/layer.js"></script>
    <script src="../js/axios.min.js"></script>
    <script src="../js/axiosConfig.js"></script>
    <script src="../js/url.js"></script>
</head>
<body>

</body>
<script>
var keyvalue = request("keyvalue");
var taid = request("taid");
var vueapp = new Vue({
el: '#app',
data: {
startTimeOptions: {},
endtime: '',
cityList: [{
value: '5',
label: '办结归档'
},
{
value: '6',
label: '关闭归档'
},
],
formInline: {
endtime: '',
status: '',
closememo: ''
},
ruleInline: {
endtime: [{
required: true,
type: 'date',
message: '请选择归档时间',
trigger: 'change'
}],
status: [{
required: true,
message: '请选择状态',
trigger: 'blur'
}]
},
isSpinShow: false,
// 交办事项详情
TaskAssignDetailModel: {
},
TaskAssignDetailViewModel: {
title: "",
assigntime: "",
assignmemo: "",
dealdesc: "",
pretime: "",
isdelay: true,
status: 0,
taskassignUnit: {},
},
TaskAssignUnitList: [
]
},
mounted: function () {
var parmDate = new Date();
this.endTimeChange(parmDate);
this.getApiTaskAssignDetailModel();
},
methods: {
//设置结束时间
endTimeChange: function (e) {
//debugger
this.endtime = e;
let endTime = this.endtime ? new Date(this.endtime).valueOf() - 1 * 24 * 60 * 60 * 1000 : '';
this.startTimeOptions = {
disabledDate(date) {
return date && date.valueOf() > Date.now() && endTime != '';
}
}
},
// 取得交办事项基本信息
getApiTaskAssignDetailModel() {
var vm = this;
var token = localStorage.getItem("wccToken"); //获取
axios({
method: "GET",
async: false,
url: apiUrl.ApiTaskDetailList + '/' + keyvalue,
headers: { "Authorization": "Bearer " + token }
//                      data: '',
}).then(function (ret) {
console.log("交办事项基本信息：" + JSON.stringify(ret.data));
vm.TaskAssignDetailModel = ret.data.data.data;
if (vm.TaskAssignDetailModel.taskassigns.length > 0) {
vm.TaskAssignDetailViewModel.title = vm.TaskAssignDetailModel.title;
vm.TaskAssignDetailViewModel.assigntime = vm.TaskAssignDetailModel.taskassigns[0].assigntime;
vm.TaskAssignDetailViewModel.assignmemo = vm.TaskAssignDetailModel.taskassigns[0].assignmemo;
vm.TaskAssignUnitList = vm.TaskAssignDetailModel.taskassigns[0].taskassignUnits;
}
});
},
fnsave() {
var $this = this;
this.$refs["formInline"].validate((valid) => {
if (valid) {
$this.formInline.id = taid;
$.Apiaxios({
method: "POST",
url: apiUrl.ApiUpdateAssignTask,
data: JSON.stringify($this.formInline),
IsLoading: true,
content: "提交数据中，请稍后...",
success: function (ret) {
parent.myVue.getData(parent.myVue.wh_sn, parent.myVue.wh_parmdata);
html_cancel();
}
});
}
})

}
//					handleSubmit(name) {
//
//					},
//					handleChange(daterange) {
//						this.formInline.endtime = daterange;
//					}
}
});
function html_cancel() {
parent.LoadTable();
}
</script>
</html>