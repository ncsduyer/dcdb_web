<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>欢迎登录后台管理系统--区委办督查督办系统</title>
		<link rel="Bookmark" href="/favicon.ico">
		<link rel="Shortcut Icon" href="/favicon.ico" />
		<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
		<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
		<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
		<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
		<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
		<script src="js/url.js"></script>

	</head>
	<body>
		<article class="page-container">
			<form class="form form-horizontal" id="form-article-add">
				<div id="RowData">
					<div id="Row_0" name="Row">
						<div class="row cl">
							<label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>责任单位：</label>
							<div class="formControls col-xs-8 col-sm-9">
								<div class="ui-select" type="select" id="company_id" name="company_id"></div>
							</div>
						</div>
						<div class="row cl">
							<label class="form-label col-xs-3"><span class="c-red">*</span>督办时间：</label>
							<div class="formControls col-xs-8">
								<input type="text" class="input-text" value="" placeholder="" id="createdTime" name="createdTime" readonly />
							</div>
						</div>
						<div class="row cl">
							<label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>督办情况：</label>
							<div class="formControls col-xs-8 col-sm-9">
								<textarea style="width:100%;height:70px;resize: none;" id="situation" name="situation"></textarea>
							</div>
						</div>
						<div class="row cl">
							<label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>单位人员：</label>
							<div class="formControls col-xs-8 col-sm-9">
								<input type="text" class="input-text" value="" placeholder="" id="submitter" name="submitter">
							</div>
						</div>
					</div>
				</div>
				<div class="row cl">
					<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
						<button onClick="article_save();" class="btn btn-secondary radius" type="button"><i class="Hui-iconfont">&#xe632;</i>
							保存提交</button>
						<button onClick="article_cancel();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
					</div>
				</div>
			</form>
		</article>
	</body>
</html>
<script type="text/javascript">
	var awid = request('id');
	var type = request('type');
	var time = new Date();
	var DateT = time.getFullYear() + "-" + (time.getMonth() + 1) + "-" + time.getDate() + " " + time.getHours() +
		":" + time.getMinutes();
    $(function () {
        $("#createdTime").attr("onfocus", "WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',maxDate:'" + DateT + "' })")
        $.apiAjax({
            type: "Get",
            alert: false,
            url: apiUrl.ApiassignWorkDetail + '/' + awid,
            success: function (ret) {
                var arrycompany = [];
                $(ret.workCompanies).each(function () {
                    arrycompany.push(this.company);
                });
                $("#company_id").ComboBox({
                    data: arrycompany,
                    id: "id",
                    text: "title",
                    defultSelect: true
                });
            }
        });
    });

	function article_save() {
        var Rowdata = $("#RowData").GetWebControls();
        //alert(Rowdata.createdTime);
        if (!Rowdata.createdTime) {
            //0-警告；1-成功；2-失败
            DialogMsg('请选择督办时间！');
            return;
        }
		if (!Rowdata.situation) {
			//0-警告；1-成功；2-失败
			DialogMsg('请填写督办情况！');
			return;
		}
		if (!Rowdata.submitter) {
			//0-警告；1-成功；2-失败
			DialogMsg('请填写单位人员！');
			return;
		}
        Rowdata.a_w_id = awid;
        Rowdata.createdTime = Rowdata.createdTime + ":00";
		$.apiAjax({
			type: "POST",
			url: apiUrl.ApiwcInfosAdd,
			data: JSON.stringify(Rowdata),
			IsLoading: true,
			IsClose: true,
			success: function(ret) {
                parent.LoadTable();
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
			}
		});

	}

	function article_cancel() {
		var index = parent.layer.getFrameIndex(window.name);
		parent.layer.close(index);
	}
</script>
