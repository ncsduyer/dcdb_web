<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<!--[if lt IE 9]>
    <script type="text/javascript" src="lib/html5shiv.js"></script>
    <script type="text/javascript" src="lib/respond.min.js"></script>
    <![endif]-->
		<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />


		<!--[if IE 6]>
    <script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->

		<title>督办事项</title>
		<style>
			.mycenter {
            text-align: center;
        }
    </style>
		<!--_footer 作为公共模版分离出去-->
		<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
		<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
		<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
		<script src="js/url.js"></script>

		<!--/_footer 作为公共模版分离出去-->
		<!--请在下方写此页面业务相关的脚本-->
		<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
		<script type="text/javascript" src="lib/datatables/1.10.15/jquery.dataTables.min.js"></script>
		<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>

	</head>

	<body>

		<div class="page-container">
			<div class="cl bg-1 bk-gray">
				<span class="l">
					<a class="btn btn-primary radius" id="1051752060833345539" data-title="新建督办事项" onclick="article_add('新建督办事项', 'supervise-add.html')"
					 href="javascript:;">
						<i class="Hui-iconfont">&#xe600;</i> 新建
					</a>
					<!-- 	<a href="javascript:;" onclick="member_update('2')" class="btn btn-primary  radius"><i class="Hui-iconfont">&#xe6de;</i>
						批量归档</a> -->
					<a href="javascript:;" id="1051752060833345538" onclick="fn_search('0',this)" class="btn btn-primary btn-danger radius">
						待处理</a>
					<a href="javascript:;" id="1051752060833345538" onclick="fn_search('1',this)" class="btn btn-primary  radius"><i
						 class="Hui-iconfont">&#xe6d7;</i>
						已分派未反馈</a>
					<a href="javascript:;" id="1051752060833345538" onclick="fn_search('2',this)" class="btn btn-primary radius"><i
						 class="Hui-iconfont">&#xe6d7;</i>
						已反馈办理限期中 </a>
					<a href="javascript:;" id="1051752060833345538" onclick="fn_search('3',this)" class="btn btn-primary radius"><i
						 class="Hui-iconfont">&#xe6d7;</i>
						已反馈办理超期中</a>
					<a href="javascript:;" id="1051752060833345538" onclick="fn_search('4',this)" class="btn btn-primary radius"><i
						 class="Hui-iconfont">&#xe6d7;</i>
						已归档(办结|关闭) </a>
					<a href="javascript:;" id="1051752060833345538" onclick="fn_search('5',this)" class="btn btn-primary radius"><i
						 class="Hui-iconfont">&#xe709;</i>
						全部</a>
					<a href="javascript:;" id="1051752060833345538" onclick="Hiddendiv(this)" class="btn btn-primary radius">
						显示查询条件</a>
					<a onclick="Checkreport()" id="1051752060833345538" class="btn btn-primary  radius"><i class="Hui-iconfont">&#xe6de;</i>
						报表生成</a>
				</span>
				<script>
					$('.l').authorizeButton()
				</script>
				<span class="r"></span>
			</div>
			<div style="display: none;" id="searchwhere">
				</br>
				<table id="TableParm">
					<tr>
						<td style="width: 80px;">&nbsp;事项名称：</td>
						<td style="width: 200px;"><input type="text" class="input-text" value="" placeholder="" id="title" name="title">
						</td>
						<td style="width: 80px;">&nbsp;事件类型：</td>
						<td style="width: 200px;">
							<div class="ui-select" type="select" id="astatus" name="workType"></div>
						</td>
						<td style="width: 80px;">&nbsp;开始时间：</td>
						<td style="width: 200px;"><input type="text" class="input-text" value="" placeholder="" id="beforeTime" name="beforeTime"
							 onclick="WdatePicker({ })" readonly /></td>
						<td style="width: 80px;">&nbsp;结束时间：</td>
						<td style="width: 200px;"><input type="text" class="input-text" value="" placeholder="" id="afterTime" name="afterTime"
							 onclick="WdatePicker({  })" readonly /> </td>
						<td>&nbsp;&nbsp;&nbsp;</td>
						<td><a href="javascript:;" id="1051752060833345538" onclick="fn_search(null,null)" class="btn btn-primary radius">查询</a>
						</td>
					</tr>
				</table>
			</div>
			<div class="mt-20">
				<table id="mytabledtlist" class="table table-border table-bordered table-bg table-hover table-sort"></table>
			</div>
		</div>




		<!--按钮功能入口-->
		<script type="text/javascript">
			var Status = "0";
			var arrPermissions = localStorage.getItem("Permissions").split(',');
			var UserId = localStorage.getItem("UserId");
			$(function() {
				var YmId = "1051752060833345538";
				var assignWork = "";
				var arrAId = [];
				$("#astatus").ComboBox({
					url: apiUrl.ApiworkTypeList,
					id: "id",
					text: "title",
					description: "==请选择==",
				});
				fn_init_dataTable();
			});

			function Hiddendiv(obj) {
				if ($("#searchwhere").css("display") == "none") {
					$("#searchwhere").css("display", "");
					$(obj).html("隐藏查询条件");
				} else {
					$("#searchwhere").css("display", "none");
					$(obj).html("显示查询条件");
				}

			}

			function fn_init_dataTable() {
				if ($("#1051752060833345538").css("display") == "none") {
					return;
				}
				$('#mytabledtlist').dataTable({
					"destroy": true, //如果需要重新加载的时候请加上这个
					"paging": true, //是否分页
					"scrollY": 600, //高度超过多少出现滚动条
					// "data": objdatarecords,
					"aLengthMenu": [20, 50, 100], //更改显示记录数选项 
					"bPaginate": false, //是否显示（应用）分页器 
					"bInfo": true, //是否显示页脚信息，DataTables插件左下角显示记录数 
					"searching": false, //是否出现搜索狂
					"serverSide": true,
					"deferRender": true,
					"bFilter": false,
					"bAutoWidth": false,
					ajax: function(data, callback, settings) {
						var ordernum=data.order[0].column;
						var sort=data.order[0].dir;
						var ordername="a."+data.columns[ordernum].data+" "+sort;
						var senddata = $("#TableParm").GetWebControls();
						senddata.order=ordername;
						if (data.start) {
							senddata.page = data.start % data.length === 0 ? (data.start / data.length + 1) : ((data.start % data.length) +
								2);
						}
						senddata.limit = data.length;
						if (Status != 5) {
							if (Status == "1") {
								senddata.status = [1];
							} else if (Status == "2") {
								senddata.status = [1, 2, 3];
							} else if (Status == "3") {
								senddata.status = [5];
							} else if (Status == "4") {
								senddata.status = [6, 9];
							} else if (Status == "0") {
								senddata.status = [0, 1, 2, 3, 4, 5];
								senddata.agent = UserId;
								senddata.created_id = UserId;
							}
						}
						$.apiAjax({
							type: "POST",
							url: apiUrl.ApiassignWorkList,
							alert: false,
							data: JSON.stringify(senddata),
							IsLoading: true,
							success: function(ret) {
								var lists = ret;
								var returnData = {};
								returnData.draw = data.draw; //这里直接自行返回了draw计数器,应该由后台返回
								returnData.recordsTotal = lists.pages;
								returnData.recordsFiltered = lists.total; //后台不实现过滤功能，每次查询均视作全部结果
								returnData.data = lists.records;
								callback(returnData);
							}
						});
					},
					//ordering: false,//是否排序
					"columns": [
						// {
						// 		"data": "id", //对应数据项
						// 		"title": '<input type="checkbox" onclick="fn_selectallchecked(this);" />', //标题
						// 		"orderable": false, //是否排序
						// 		//"orderData": [ 1, 2 ],//安装第2列和第3列排序，如果是单列则不需要中括号
						// 		"windth": "5%", //宽度
						// 		"visible": true, //是否显示
						// 		"render": function(data, type, full, meta) {
						// 			return '<div style="text-align:center;"><input type="checkbox" value="' + data + '" /></div>';
						// 		},
						// 		"className": "mycenter" //居中显示
						// 	},
						// 	{
						// 		"data": "id",
						// 		"title": "编号",
						// 		"orderable": true,
						// 		"orderData": 1, //安装第1列和第2列排序，如果是单列则不需要中括号
						// 		"className": "mycenter"
						// 	},
						{
							"data": "created_time",
							"title": "交办时间",
							"render": function(data, type, full, meta) {
								var ss_show = data;
								return '<div style="text-align:center;">' + ss_show + '</div>';
							},
							"className": "mycenter",
							"sWidth": "128px"
						},
						{
							"data": "title",
							"title": "交办事项",
							"className": "mycenter",
							"sWidth": "170px"
						},
						{
							"data": "workCompanies",
							"title": "责任单位",
							"render": function(data, type, full, meta) {
								var ss_show = "";
								$(data.split(',')).each(function(index, item) {
									ss_show += item + "<br/>";
								});

								if (ss_show == "undefined") {
									ss_show = "";
								}

								return '<div style="text-align:left;">' + ss_show + '</div>';
							},
							"className": "mycenter",
							"sWidth": "100px",
							"bSortable": false
						},

						{
							"data": "agentname",
							"title": "督办责任人",
							"className": "mycenter",
							"sWidth": "80px",
							"bSortable": false
						},
						{
							"data": "requirement",
							"title": "办理要求",
							"className": "mycenter"
						},
						{
							"data": "deadline",
							"title": "办结时限",
							"className": "mycenter",
							"sWidth": "120px"
						},
						{
							"data": "statusname",
							"title": "目前状态",
							"className": "mycenter",
							"render": function(data, type, full, meta) {
								//1已下发未反馈,2已反馈,3欠进度,4达进度,5超进度,6已完成,7现场办结,8允许延期,9手动关闭
								var ss_show = '<div style="text-align:center;color:#ff8300;">' + data + '</div>';

								return ss_show;
							},
							"className": "mycenter",
							"sWidth": "100px",
							"bSortable": false
						},
						{
							"data": "is_exceed",
							"title": "是否超期",
							"className": "mycenter",
							"sWidth": "70px",
							"bSortable": false
						},
						//{
						//	"data": "end_time",
						//	"title": "归档时间",
						//	"className": "mycenter",
						//	"sWidth": "135px"
						//},
						{
							"data": "useTime",
							"title": "总共用时",
							"className": "mycenter",
							"sWidth": "100px",
							"bSortable": false
						},
						{
							"data": "id", //对应数据项
							"title": "操作",
							"orderable": false, //是否排序
							"render": function(data, type, full, meta) {
								var arrbtn = "";
                                arrbtn += "<a style=\"text-decoration:none;color:blue;\"  class=\"ml-5\" onclick=\"CheckDetailsInfo( '" +
                                    data +
                                    "')\" href=\"javascript:;\" title=\"查看\"><u>查看</u></a>";

								if (full.status != 6 && full.status != 9) {
									if (arrPermissions.indexOf('1051752060833345540') > 0 && full.status == 1 && full.agent ==UserId) {
										arrbtn += "<a style=\"text-decoration:none;color:blue;\" class=\"ml-5\" onclick=\"feedback( '" + data +
											"')\" href=\"javascript:;\" title=\"反馈\"><u>反馈</u></a>";

									}
									if (arrPermissions.indexOf('1065176202181935112') > 0 && full.status > 1 && full.agent ==UserId) {
										arrbtn += "<a style=\"text-decoration:none;color:blue;\" class=\"ml-5\" onclick=\"banli( '" + data +
											"')\" href=\"javascript:;\" title=\"督办登记\"><u>督办登记</u></a>";

									}
									if (arrPermissions.indexOf('1062589527937323016') > 0 && full.created_id == UserId) {
										arrbtn += "<a style=\"text-decoration:none;color:blue;\" class=\"ml-5\" onclick=\"banjie( '" + data +
											"','" + full.created_time + "')\" href=\"javascript:;\" title=\"归档\"><u>归档</u></a>";

									}
								}
								return '<span class="f-14 l"></span><span class="f-14">' + arrbtn + '</span>';
							},
							"className": "mycenter",
							"sWidth": "135px",
							"bSortable": false
						}

					]
				});

			}


			function fn_search(sn, obj) {
				if (obj) {
					ChoiceClass(obj);
				}
				if (sn) {
					Status = sn;
				}
				$("#mytabledtlist").dataTable().fnDraw(true);
			}


			function ChoiceClass(obj) {
				$(".l a").each(function() {
					if (this == obj) {
						$(this).addClass("btn-danger");
					} else {
						$(this).removeClass("btn-danger");
					}

				});

            }

            function LoadTable() {
                $("#mytabledtlist").dataTable().fnDraw(true);
            }

			/*文章-添加*/
			function article_add(title, url, w, h) {
				var index = layer.open({
					type: 2,
					title: title,
					content: url
				});
				layer.full(index);
			}
			/*文章-编辑*/
			function CheckDetailsInfo(obj) {
				var index = layer.open({
					id: "CheckInfo",
					type: 2,
					title: "查看督办事项信息",
					area: [$(window).width() + "px", $(window).height() + "px"],
					content: "supervision_details.html?id=" + obj
				});

				layer.full(index);
			}

			function banli(obj) {
				var index = layer.open({
					id: "UpdateSpeed",
					type: 2,
					title: "事项督办登记",
					area: ["800px", "600px"],
					content: "UpdateSpeed.html?type=0&id=" + obj
				});
			}

			function feedback(obj) {
				var index = layer.open({
					id: "feedback",
					type: 2,
                    title: "责任单位的信息反馈",
                    area: ["800px", "600px"],
					//area: [$(window).width() + "px", $(window).height() + "px"],
					content: "feedback.html?type=0&id=" + obj
				});
				layer.full(index);
			}

			function banjie(obj, time) {
				var index = layer.open({
					type: 2,
                    title: "归档操作",
                    area: ["800px", "600px"],
					//area: [$(window).width() + "px", $(window).height() + "px"],
					content: "banjie.html?id=" + obj + "&time=" + time
				});
				//layer.full(index);

			}

			function Checkreport() {
				var index = layer.open({
					type: 2,
					title: "督办事项报表",
					area: [$(window).width() + "px", $(window).height() + "px"],
					content: "dcdbbb.html"
				});
				layer.full(index);

			}


			/*文章-删除*/
			// 			function article_del() {
			// 				layer.confirm('确认要删除吗？', function(index) {
			// 
			// 					var strdel_aids = '';
			// 					$("#mytabledtlist tbody tr td input[type='checkbox']:checked").each(function(index, item) {
			// 						strdel_aids += ',' + $(item).attr("value");
			// 					});
			// 
			// 					layer.msg('未通过', {
			// 						icon: 5,
			// 						time: 1000
			// 					});
			// 				}, function() {
			// 					layer.msg('已启用', {
			// 						icon: 6,
			// 						time: 1000
			// 					});
			// 				});
			// 			}
			// 
			// 			/*文章-发布*/
			// 			function article_publish() {
			// 
			// 				var s_cx_articlecolumn = $("#cx_articlecolumn").val();
			// 				if (s_cx_articlecolumn == "0") {
			// 					layer.msg('请选择发布数据栏目！', {
			// 						icon: 6,
			// 						time: 1000
			// 					});
			// 					return;
			// 				}
			// 				layer.confirm('是否要发布最新数据？', function(index) {
			// 					$.ajax({
			// 						type: 'POST',
			// 						url: '../include/articlecreatejs.php',
			// 						dataType: 'html',
			// 						data: "articlecolumn=" + s_cx_articlecolumn,
			// 						success: function(rdata) {
			// 							//alert(rdata);
			// 							layer.msg('发布最新数据成功！', {
			// 								icon: 1
			// 							}); //0-警告；1-成功；2-失败
			// 						},
			// 						error: function(data) {
			// 							//alert("err");
			// 							//console.log(data);
			// 						}
			// 					});
			// 				}, function() {
			// 					//layer.msg('操作失败', { icon: 6, time: 1000 });
			// 				});
			// 			}
			//计算时间差
			
		</script>

	</body>

</html>
