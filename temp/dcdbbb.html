<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>督察督办报表</title>
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />

		<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="lib/datatables/1.10.15/jquery.dataTables.min.js"></script>
		<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
		<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
		<script src="js/url.js"></script>
	</head>
	<body>
		<div class="cl bg-1 bk-gray" style="margin-left: 5px; ">
			<span class="l">
				<!-- 	<a href="javascript:;" onclick="member_update('2')" class="btn btn-primary  radius"><i class="Hui-iconfont">&#xe6de;</i>
				批量归档</a> -->
			</span>
			<br />
			<table id="TableParm">
				<tr>
					<td style="width: 80px;">&nbsp;开始时间：</td>
					<td style="width: 200px;"><input type="text" class="input-text" value="" placeholder="" id="beforeTime" name="beforeTime"
						 onclick="WdatePicker({ })" readonly /></td>
					<td style="width: 80px;">&nbsp;结束时间：</td>
					<td style="width: 200px;"><input type="text" class="input-text" value="" placeholder="" id="afterTime" name="afterTime"
						 onclick="WdatePicker({  })" readonly /> </td>
					<td style="width: 80px;">&nbsp;报表名称：</td>
					<td style="width: 200px;">
						<div class="ui-select" type="select" id="reportName" name="reportName"></div>
					<td>&nbsp;&nbsp;</td>
					<td><a href="javascript:;" id="querydata" onclick="queryData()" class="btn btn-primary radius">
							查询</a>
						<a href="javascript:;" id="1051752060833345538" style="display: none;" onclick="Generatereport()" class="btn btn-primary radius">
							生成</a>
					</td>
				</tr>
			</table>
			<br />
		</div>
		<div id="app" style="margin-left: 10px;">
			<table id="mytabledtlist" name="mytabledtlist" style="float: left; " class="table table-border table-bordered table-bg table-hover table-sort"></table>
		</div>

		<script>
			var beforeTime = "";
			var afterTime = "";
			var reportName = "";
			var reportId = "";
			var Ishidden = false;
			$(function() {
				$("#reportName").ComboBox({
					url: apiUrl.ApiWorkReportdateGroup,
					id: "id",
					text: "name",
					description: "",
					allowSearch: true
				});
				fn_init_dataTable([]);
			})

			function queryData() {

				if ($("#reportName").attr("data-value") || ($("#afterTime").val() && $("#beforeTime").val())) {
					reportName = $("#reportName").attr("data-text");
					afterTime = $("#afterTime").val();
					beforeTime = $("#beforeTime").val();
					reportId = $("#reportName").attr("data-value");
					if (reportId) {
						Ishidden = true;
					} else {
						Ishidden = false;
					}
					$.apiAjax({
						type: "POST",
						url: apiUrl.ApiWorkReportlist,
						alert: false,
						data: JSON.stringify({
							dateGroup: reportId,
							afterTime: afterTime,
							beforeTime: beforeTime
						}),
						IsLoading: true,
						success: function(ret) {
							fn_init_dataTable(ret);
						}
					});
					$("#1051752060833345538").css("display", "");
				} else {
					reportName = "";
					afterTime = "";
					beforeTime = "";
					reportId = "";
					DialogMsg("请选择时间或选择已生成报表查询");
					$("#1051752060833345538").css("display", "none");
					return;
				}

			}

			function UpdateTableData(id) {
				$.apiAjax({
					type: "POST",
					url: apiUrl.ApiWorkReportlist,
					alert: false,
					data: JSON.stringify({
						dateGroup: reportId,
					}),
					IsLoading: true,
					success: function(ret) {
						fn_init_dataTable(ret);
					}
				});

			}

			function fn_init_dataTable(data) {
				$("#mytabledtlist").dataTable({
					width: "300px",
					height: "700px",
					"columns": [{
							"data": "id",
							"title": "序号",
							"sWidth": "25px",
							"render": function(data, type, full, meta) {
								return meta.row + 1 + meta.settings._iDisplayStart;
							}
						},
						{
							"data": "createdTime",
							"title": "交办时间",
							"render": function(data, type, full, meta) {
								var ss_show = data;
								return '<div style="text-align:center;">' + ss_show + '</div>';
							},
							"className": "mycenter",
							"sWidth": "135px"
						},
						{
							"data": "title",
							"title": "交办事项",
							"className": "mycenter",
							"sWidth": "170px"
						},
						{
							"data": "company",
							"title": "责任单位",
							"render": function(data, type, full, meta) {
								var ss_show = "";
								$(data.split(',')).each(function(index, item) {
									ss_show += item + "<br/>";
								});

								if (ss_show == "undefined") {
									ss_show = "";
								}

								return '<div style="text-align:center;">' + ss_show + '</div>';
							},
							"className": "mycenter",
							"sWidth": "170px"
						},
						{
							"data": "agent",
							"title": "督办责任人",
							"className": "mycenter",
							"sWidth": "100px"
						},
						{
							"data": "requirement",
							"title": "办理要求及时限",
							"className": "mycenter"
						},
						{
							"data": "useTime",
							"title": "办理用时",
							"className": "mycenter",
							"sWidth": "135px"
						},
						{
							"data": "status",
							"title": "事项进度",
							"className": "mycenter",
							"render": function(data, type, full, meta) {
								//1已下发未反馈,2已反馈,3欠进度,4达进度,5超进度,6已完成,7现场办结,8允许延期,9手动关闭
								var ss_show = '<div style="text-align:center;color:#ff8300;">' + data + '</div>';

								return ss_show;
							},
						},
						{
							"data": "id", //对应数据项
							"title": "操作",
							"orderable": false, //是否排序
							"render": function(data, type, full, meta) {
								if (Ishidden) {
									return '<a style=\"text-decoration:none;color:blue;\"  class=\"ml-5\" onclick=\"editDetail( ' + data +
										')\" href=\"javascript:;\" title=\"修改\"><u>修改</u></a>' +
										'<a style=\"text-decoration:none;color:blue;\"  class=\"ml-5\" onclick=\"DeleteData( ' + data +
										')\" href=\"javascript:;\" title=\"删除\"><u>删除</u></a>';
								} else {
									return "";
								}
							},
							"className": "mycenter",
							"sWidth": "135px"
						}
					],
					data: data,
					"destroy": true, //如果需要重新加载的时候请加上这个
					"scrollY": 560, //高度超过多少出现滚动条
					"bInfo": true, //是否显示页脚信息，DataTables插件左下角显示记录数 
					"searching": false, //是否出现搜索狂

				});
			}

			function DeleteData(obj) {
				$.apiAjax({
					type: "get",
					url: apiUrl.ApiWorkReportdelete + "/" + obj,
					alert: true,
					content: "删除数据中，请稍等。。。",
					success: function(ret) {
						fn_init_dataTable();
					}
				})
			}

			function editDetail(obj) {
				var index = layer.open({
					id: "edit_reportdetail",
					type: 2,
					title: "修改报表数据信息",
					area: ["900px", "700px"],
					content: "edit_reportdetail.html?id=" + obj
				});


			}

			function Generatereport() {
				var index = layer.open({
					id: "fillReportName",
					type: 2,
					title: "填写报表名称",
					area: ["800px", "600px"],
					content: "fillReportName.html?afterTime=" + afterTime + "&beforeTime=" + beforeTime
				});
			}

			function UpdateSelect() {
				$("#reportName").ComboBox({
					url: apiUrl.ApiWorkReportdateGroup,
					id: "id",
					text: "name",
					description: "==请选择==",
					allowSearch: true
				});
			}
		</script>
	</body>
</html>
